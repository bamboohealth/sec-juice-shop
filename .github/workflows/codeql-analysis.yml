name: "CodeQL Scan - BH POC"

on:
 #workflow_dispatch: #manual trigger
 push:
   branches: [ "master" ] 
 pull_request:
   branches: [ "master" ]
   # run on any branch PRs & to show results in the PR UI
   types: [opened, synchronize, reopened]

jobs:
  analyze:
   name: Analyze
   runs-on: ubuntu-latest

   #timeout prevents runaway jobs and improves how results show in GitHub UI.
   timeout-minutes: 60
   
   permissions:
     actions: read
     contents: read
     security-events: write
     pull-requests: write  # enables PR/comments 
   
   strategy:
      fail-fast: false
      matrix:
        language: [ 'javascript-typescript' ]
   
   steps:

    # checkout code and install dependencies
   - name: Checkout repository
     uses: actions/checkout@v4
     with:
      fetch-depth: 0
      

    # Set up Node.js environment
   #- name: Setup Node.js
     #uses: actions/setup-node@v4
     #with:
          #node-version: 20

    # Install project dependencies
   #- name: Install dependencies
     #run: npm ci

    # Initialized CodeQL for JavaScript
   - name: Initialize CodeQL
     uses: github/codeql-action/init@v3
     with:
       languages: ${{ matrix.language }}
       queries: security-extended
       # to optimize scan time by excluding known safe paths
       config: |
         paths-ignore: 
           - 'data/static/codefixes'
           - 'frontend/noce_modules/**'
           - 'test/'
           - 'docs/'
           - 'cypress/'

    # --(Optional) Autobuild step ---
    # Juice Shop is JavaScript-based and doesn't require a build step,
    # but this is left for completeness and compatibility.
   #- name: Autobuild
   #  uses: github/codeql-action/autobuild@v3
   #- name: Install dependencies
    # run: npm install


    # Run CodeQL analysis and upload the results 
   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@v3
     with:
          category: "/language:${{ matrix.language }}"