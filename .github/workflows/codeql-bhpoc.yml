name: "CodeQL"

on:
 push:
   branches: [ "main" ]
 pull_request:
   branches: [ "main" ]
   # run on any branch PRs
   ##types: [opened, synchronize, reopened]
jobs:
  analyze:
   name: Analyze
   runs-on: ubuntu-latest
   #timeout prevents runaway jobs and improves how results show in GitHub UI.
   timeout-minutes: 60
   permissions:
     actions: read
     contents: read
     security-events: write
   steps:

    # checkout code and install dependencies
   - name: Checkout repository
     uses: actions/checkout@v3
     with:
      fetch-depth: 0

    # juice-shop specific: setup node and install dependencies needed for analysis
   - name: Setup Node.js
     uses: actions/setup-node@v4
     with:
          node-version: 20
   - name: Install dependencies
     run: npm ci

    # Run CodeQL analysis for JavaScript
   - name: Initialize CodeQL
     uses: github/codeql-action/init@v3
     with:
       languages: 'javascript'

    # run autobuild to compile the code
    # not needed for juice-shop as it's interpreted, but left here for completeness
   - name: Autobuild
     uses: github/codeql-action/autobuild@v3

    # perform the analysis
   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@v3
     with:
          category: "/language:javascript"